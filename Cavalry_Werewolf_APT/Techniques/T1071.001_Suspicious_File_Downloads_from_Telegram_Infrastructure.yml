itle: Suspicious File Downloads from Telegram Infrastructure
id: 8c9d0e1f-2a3b-4c5d-6e7f-8a9b0c1d2e4f
status: experimental
description: |
    Detects potentially malicious file downloads originating from Telegram domains and IP addresses,
     with additional suspicious file type filtering
author: Manar Mamdouh
date: 2024/10/31
references:
   - https://www.picussecurity.com/resource/blog/cavalry-werewolf-apt
logsource:
    category: file_event
    product: windows
detection:
    telegram_domains:
        FileOriginUrl|contains:
            - 'api.telegram.org'
            - 't.me'
            - 'telegram.org'
        FileOriginReferrerUrl|contains:
            - 'api.telegram.org'
            - 't.me'
            - 'telegram.org'
    telegram_ips:
        FileOriginIp|startswith:
            - '91.108.4.'
            - '91.108.8.'
            - '91.108.12.'
            - '91.108.16.'
            - '91.108.20.'
            - '91.108.56.'
            - '149.154.160.'
            - '149.154.164.'
            - '149.154.168.'
            - '149.154.172.'
    file_creation:
        ActionType: 'FileCreated'
    suspicious_extensions:
        TargetFilename|endswith:
            - '.exe'
            - '.dll'
            - '.ps1'
            - '.bat'
            - '.cmd'
            - '.vbs'
            - '.js'
            - '.scr'
            - '.zip'
            - '.rar'
    condition: file_creation and (telegram_domains or telegram_ips) and suspicious_extensions
level: high
tags:
    - attack.exfiltration
    - attack.t1567.002
    - attack.ingress_tool_transfer
    - attack.t1105
